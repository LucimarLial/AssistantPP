---Criar no PostgreSQL - necessário para contornar problema de registros duplicados para cada reflesh do Assistant-PP, bug framework Streamlit.

CREATE OR REPLACE FUNCTION drop_duplicates() RETURNS trigger AS $$
BEGIN
	DELETE FROM tb_log_operation
	WHERE id IN (SELECT id
				  FROM (SELECT id,
								 ROW_NUMBER() OVER (partition BY name_dataset, name_column, function_operator, name_operator, type_operator ORDER BY id) AS rnum
						 FROM tb_log_operation) t
				  WHERE t.rnum > 1);
	RETURN NULL;
END;
$$ LANGUAGE plpgsql;


DROP TRIGGER IF EXISTS drop_duplicates
  ON tb_log_operation;
CREATE TRIGGER trig_drop_duplicates 
AFTER INSERT
ON tb_log_operation
    FOR EACH ROW EXECUTE PROCEDURE drop_duplicates();